<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CRISPR Genetics Lab</title>

  <!-- HARTE REINIGUNG vor allen Modulen -->
  <script>
  (function hardClean(){
    // Nur einmal ausführen
    if (sessionStorage.getItem("sw-clean-done")) return;
    sessionStorage.setItem("sw-clean-done", "1");

    // SW unregister + Caches löschen; danach einmal sauber neu laden
    if ("serviceWorker" in navigator) {
      Promise.resolve()
      .then(() => navigator.serviceWorker.getRegistrations())
      .then(rs => Promise.all((rs||[]).map(r => r.unregister())))
      .then(() => caches && caches.keys ? caches.keys() : [])
      .then(keys => Promise.all((keys||[]).map(k => caches.delete(k))))
      .finally(() => {
        // Ein Redirect verhindert, dass der alte SW das erste Laden abfängt
        var url = location.origin + location.pathname + location.hash;
        if (location.search.indexOf("clean=1") === -1) {
          location.replace(url + (url.indexOf("?")>-1 ? "&" : "?") + "clean=1");
        }
      });
    }
  })();
  </script>

  <!-- deine Styles -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <!-- deine UI / Canvas bleiben wie gehabt ... -->
  <div id="topbar">…</div>
  <canvas id="scene"></canvas>

  <!-- Module OHNE Cache-Busting -->
  <script type="module" src="./bootstrap.js"></script>
  <script type="module" src="./preflight.js"></script>
</body>
</html>