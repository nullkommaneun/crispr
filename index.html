<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>CRISPR Genetics Lab</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div id="errorOverlay" class="hidden" role="alert" aria-live="assertive"></div>

  <!-- Toolbar -->
  <header class="toolbar" id="toolbar">
    <div class="toolbar-row">
      <button id="btnPlayPause">‚ñ∂Ô∏è Play</button>
      <button id="btnReset">üîÑ Reset</button>

      <label>Timescale</label>
      <button id="btnSpeedCycle">‚ö° 1√ó</button>

      <label for="mutationRate">Mutation</label>
      <input id="mutationRate" type="range" min="0" max="10" value="0.5" step="0.1" />
      <span id="mutationRateVal" class="mono">0.5 %</span>

      <label for="foodRate">Nahrung (pro Sekunde)</label>
      <input id="foodRate" type="range" min="0" max="360" value="90" step="1" />
      <span id="foodRateVal" class="mono">90 /s</span>

      <label>Highlight</label>
      <button id="btnHighlightCycle">Alle St√§mme</button>

      <button id="btnEditor">üß¨ Editor</button>
      <button id="btnEnv"    title="Umwelt-Einstellungen">üåê Umwelt</button>
    </div>
  </header>

  <main id="main"><canvas id="simCanvas" width="800" height="520"></canvas></main>

  <!-- DNA Daily -->
  <section id="narrativeSection" aria-label="Boulevard-Schlagzeilen">
    <header class="paperHead"><span class="paperTitle">DNA Daily</span><span class="paperSub">Breaking News aus dem Labor</span></header>
    <div id="narrativePanel" class="scrollbox" tabindex="0" aria-live="polite"></div>
  </section>

  <!-- Ticker -->
  <footer id="ticker" aria-live="polite"><div id="tickerInner"><div id="tickerContent"></div></div></footer>

  <!-- Editor (unver√§ndert, mit MET & Effekten ‚Äì ggf. deine aktuelle Version einsetzen) -->
  <!-- ... (dein existierender Editor-Dialog) ... -->

  <!-- Umwelt-Modal -->
  <dialog id="envModal" aria-labelledby="envTitle">
    <form method="dialog" id="envForm">
      <header class="modalHeader">
        <h2 id="envTitle">Umwelt ‚Äì Randgefahren</h2>
        <button id="envClose" value="cancel" title="Schlie√üen">‚úñ</button>
      </header>

      <div class="modalBody">
        <section class="editorLeft">
          <h3>Gefahren aktivieren</h3>

          <div class="traitRow">
            <label><input type="checkbox" id="envAcid"> S√§urewand</label>
          </div>
          <div class="traitRow">
            <label>Reichweite</label>
            <div class="stepper"><input type="range" id="envAcidRange" min="4" max="28" step="1" value="14"><span class="val mono"></span></div>
          </div>
          <div class="traitRow">
            <label>Schaden pro Sek.</label>
            <div class="stepper"><input type="range" id="envAcidDps" min="2" max="14" step="1" value="6"><span class="val mono"></span></div>
          </div>

          <div class="traitRow">
            <label><input type="checkbox" id="envBarb"> Stacheldraht</label>
          </div>
          <div class="traitRow">
            <label>Reichweite</label>
            <div class="stepper"><input type="range" id="envBarbRange" min="4" max="18" step="1" value="8"><span class="val mono"></span></div>
          </div>
          <div class="traitRow">
            <label>Schaden (Druck)</label>
            <div class="stepper"><input type="range" id="envBarbDps" min="4" max="20" step="1" value="10"><span class="val mono"></span></div>
          </div>

          <div class="traitRow">
            <label><input type="checkbox" id="envElec"> Elektrozaun</label>
          </div>
          <div class="traitRow">
            <label>Reichweite</label>
            <div class="stepper"><input type="range" id="envElecRange" min="6" max="24" step="1" value="12"><span class="val mono"></span></div>
          </div>
          <div class="traitRow">
            <label>Schaden pro Impuls</label>
            <div class="stepper"><input type="range" id="envElecDmg" min="4" max="20" step="1" value="10"><span class="val mono"></span></div>
          </div>
          <div class="traitRow">
            <label>Impuls-Periode (s)</label>
            <div class="stepper"><input type="range" id="envElecPeriod" min="0.3" max="3" step="0.1" value="1.6"><span class="val mono"></span></div>
          </div>

          <small class="hint">Reichweite misst den Abstand zur Au√üenkante; gr√∂√üere Werte wirken tiefer in das Feld.</small>
        </section>

        <section class="editorRight">
          <h3>Hinweis</h3>
          <div class="advisorBox"><div class="advisorHeader"><strong>Visualisierung</strong></div>
            <p class="hint">S√§ure: gelber Schimmer ‚Ä¢ Stacheldraht: kleine Zacken ‚Ä¢ Elektro: blaues Lineset. Effekte sind leichtgewichtig und GPU-schonend.</p>
          </div>
        </section>
      </div>
    </form>
  </dialog>

  <!-- Booter -->
  <script type="module">
    const ov = document.getElementById('errorOverlay');
    const show = m => { if(ov){ ov.textContent=m; ov.classList.add('show'); } };
    async function safeImport(spec){
      try { return await import(spec); }
      catch (e) {
        try{
          const url=spec.replace(/\?.*$/,''); const r=await fetch(url,{cache:'no-store'});
          const ct=(r.headers.get('content-type')||'').toLowerCase();
          if(!r.ok) show(`‚ö†Ô∏è Import fehlgeschlagen: ${url} ‚Äî HTTP ${r.status}`);
          else if(!/javascript|ecmascript/.test(ct)) show(`‚ö†Ô∏è Import fehlgeschlagen: ${url} ‚Äî MIME "${ct}"`);
          else show(`‚ö†Ô∏è Import fehlgeschlagen: ${url} ‚Äî ${e?.message||e}`);
        }catch{ show(`‚ö†Ô∏è Import fehlgeschlagen: ${spec}`); }
        console.error('[Boot import error]', spec, e); throw e;
      }
    }
    (async ()=>{
      try{
        await safeImport('./errorManager.js');
        await safeImport('./event.js');
        await safeImport('./genetics.js');
        await safeImport('./environment.js');   // <- neu
        await safeImport('./entities.js');
        await safeImport('./reproduction.js');
        await safeImport('./renderer.js');
        await safeImport('./ticker.js');
        await safeImport('./advisor.js');
        await safeImport('./editor.js');
        await safeImport('./narrative/panel.js');
        await safeImport('./spawn.js');
        await safeImport('./engine.js');
      }catch(e){}
    })();
  </script>
  <script nomodule>
    const ov=document.getElementById('errorOverlay');
    ov && (ov.textContent='‚ö†Ô∏è Dieser Browser unterst√ºtzt keine ES-Module.', ov.classList.add('show'));
  </script>
</body>
</html>